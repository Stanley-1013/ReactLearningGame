{
  "name": "React å­¸ç¿’éŠæˆ² - é€²åº¦è¿½è¹¤ API",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "track-learning-progress",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "webhook-trigger-progress",
      "name": "é€²åº¦è¿½è¹¤è§¸ç™¼å™¨",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [200, 300],
      "webhookId": "track-learning-progress"
    },
    {
      "parameters": {
        "jsCode": "// è™•ç†é€²åº¦è¿½è¹¤è«‹æ±‚\nconst requestBody = $input.item(0).json.body;\n\nconsole.log('æ”¶åˆ°é€²åº¦è¿½è¹¤è«‹æ±‚:', requestBody);\n\n// å¾è«‹æ±‚ä¸­æå–é€²åº¦è³‡æ–™\nconst progressData = {\n  timestamp: requestBody.timestamp || new Date().toISOString(),\n  source: requestBody.source || 'react-learning-game',\n  action: requestBody.action || 'track_progress',\n  userId: requestBody.data?.user_id || 'anonymous',\n  moduleId: requestData.data?.module_id,\n  themeId: requestBody.data?.theme_id,\n  completed: requestBody.data?.completed || false,\n  score: requestBody.data?.score || 0,\n  timeSpent: requestBody.data?.time_spent || 0,\n  language: requestBody.data?.language_code || 'zh-TW'\n};\n\n// é€™è£¡å¯ä»¥å°‡é€²åº¦è³‡æ–™å„²å­˜åˆ°è³‡æ–™åº«ã€ç™¼é€åˆ° Slackã€å¯„é€ Email ç­‰\n// ä¾‹å¦‚ï¼š\n// - é€£æ¥åˆ° Google Sheets è¨˜éŒ„é€²åº¦\n// - ç™¼é€åˆ° Slack é »é“é€šçŸ¥\n// - å„²å­˜åˆ° Airtable æˆ–å…¶ä»–è³‡æ–™åº«\n// - è§¸ç™¼ Email é€šçŸ¥\n\nconsole.log('é€²åº¦å·²è¨˜éŒ„:', progressData);\n\n// è¨ˆç®—ä¸€äº›çµ±è¨ˆè³‡æ–™\nconst stats = {\n  totalModulesCompleted: progressData.completed ? 1 : 0,\n  averageScore: progressData.score,\n  totalTimeSpent: progressData.timeSpent\n};\n\n// å›å‚³æˆåŠŸå›æ‡‰\nreturn {\n  success: true,\n  message: 'é€²åº¦è¿½è¹¤æˆåŠŸ',\n  data: {\n    recorded: progressData,\n    stats: stats\n  },\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "process-progress",
      "name": "è™•ç†é€²åº¦è³‡æ–™",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [400, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods", 
                "value": "POST, GET, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "respond-progress",
      "name": "å›æ‡‰é€²åº¦è«‹æ±‚",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [600, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "notification-condition",
              "leftValue": "={{ $node['è™•ç†é€²åº¦è³‡æ–™'].json.data.recorded.completed }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-completion",
      "name": "æª¢æŸ¥æ˜¯å¦å®Œæˆ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [400, 500]
    },
    {
      "parameters": {
        "jsCode": "// ç•¶ç”¨æˆ¶å®Œæˆæ¨¡çµ„æ™‚çš„é¡å¤–è™•ç†\nconst progressData = $node['è™•ç†é€²åº¦è³‡æ–™'].json.data.recorded;\n\n// å¯ä»¥åœ¨é€™è£¡æ·»åŠ ï¼š\n// 1. ç™¼é€æ­å–œè¨Šæ¯åˆ° Slack\n// 2. å¯„é€å®Œæˆè­‰æ›¸\n// 3. è§£é–æ–°çš„å­¸ç¿’å…§å®¹\n// 4. æ›´æ–°ç”¨æˆ¶ç­‰ç´šæˆ–å¾½ç« \n\nconsole.log(`ğŸ‰ ç”¨æˆ¶å®Œæˆäº†æ¨¡çµ„ ${progressData.moduleId}ï¼åˆ†æ•¸ï¼š${progressData.score}`);\n\nreturn {\n  celebration: true,\n  message: `æ­å–œå®Œæˆ ${progressData.themeId} çš„æ¨¡çµ„ ${progressData.moduleId}ï¼`,\n  score: progressData.score,\n  nextActions: [\n    'ç¹¼çºŒæŒ‘æˆ°ä¸‹ä¸€å€‹æ¨¡çµ„',\n    'åˆ†äº«ä½ çš„æˆæœ',\n    'æŸ¥çœ‹å­¸ç¿’çµ±è¨ˆ'\n  ]\n};"
      },
      "id": "celebrate-completion",
      "name": "æ…¶ç¥å®Œæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 600]
    }
  ],
  "connections": {
    "é€²åº¦è¿½è¹¤è§¸ç™¼å™¨": {
      "main": [
        [
          {
            "node": "è™•ç†é€²åº¦è³‡æ–™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è™•ç†é€²åº¦è³‡æ–™": {
      "main": [
        [
          {
            "node": "å›æ‡‰é€²åº¦è«‹æ±‚",
            "type": "main",
            "index": 0
          },
          {
            "node": "æª¢æŸ¥æ˜¯å¦å®Œæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æª¢æŸ¥æ˜¯å¦å®Œæˆ": {
      "main": [
        [
          {
            "node": "æ…¶ç¥å®Œæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "versionId": "1"
}